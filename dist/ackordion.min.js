!function(root,factory){"use strict";"function"==typeof define&&define.amd?define("ackordion",factory):"object"==typeof exports?exports=module.exports=factory():root.ackordion=factory()}(this,function(){"use strict";function qs(expr,context){return(context||document).querySelector(expr)}function qsa(expr,context){return[].slice.call((context||document).querySelectorAll(expr),0)}function rAF(callback){window.requestAnimationFrame(callback)}function nextFrame(callback){window.requestAnimationFrame(function(){window.requestAnimationFrame(callback)})}function initCallbacks(){var key;callbacks={};for(key in EVENT_NAMES)EVENT_NAMES.hasOwnProperty(key)&&(callbacks[EVENT_NAMES[key]]=[])}function addCallbackForEvent(eventName,cb){var collection=callbacks[eventName=eventName.toLowerCase()];collection&&"function"==typeof cb&&collection.push(cb)}function triggerEvent(eventName,accordion,item){var i,max,collection=callbacks[eventName]||[];for(i=0,max=collection.length;max>i;i++)collection[i].call(this,eventName,accordion,item)}function getAckordionTabPanel(element){for(var root=element;root;)if(root=root.parentElement,root&&"tabpanel"===root.getAttribute("role"))return root;return void 0}function expand(element,accordion){function transitionEnd(event){"max-height"===event.propertyName&&(element.style.maxHeight!==accordion.closeHeight&&(element.classList.add("ackordion-fix-safari-bug"),element.style.maxHeight="none",setTimeout(function(){element.classList.remove("ackordion-fix-safari-bug"),triggerEvent("afteropen",accordion,element)},0)),element.removeEventListener(transitionEndName,transitionEnd,!1))}if(element){triggerEvent("beforeopen",accordion,element),element.classList.add("ackordion-fix-safari-bug"),element.style.maxHeight="none";var BCR=element.getBoundingClientRect();element.style.maxHeight=accordion.closeHeight,ackordion.isTransitionEndDisabled||element.addEventListener(transitionEndName,transitionEnd,!1),nextFrame(function(){element.classList.remove("ackordion-fix-safari-bug"),rAF(function(){element.style.maxHeight=BCR.height+"px"})})}}function collapse(element,accordion){function transitionEnd(event){"max-height"===event.propertyName&&(triggerEvent("afterclose",accordion,element),element.removeEventListener(transitionEndName,transitionEnd,!1))}if(element){triggerEvent("beforeclose",accordion,element),element.classList.add("ackordion-fix-safari-bug"),element.style.maxHeight="none";var BCR=element.getBoundingClientRect(),height=BCR.height;if(0===height||height+"px"===accordion.closeHeight)return element.classList.remove("ackordion-fix-safari-bug"),void triggerEvent("afterclose",accordion,element);element.style.maxHeight=height+"px",ackordion.isTransitionEndDisabled||element.addEventListener(transitionEndName,transitionEnd,!1),nextFrame(function(){element.classList.remove("ackordion-fix-safari-bug"),rAF(function(){element.style.maxHeight=accordion.closeHeight})})}}function toggle(element){if(element){var tabpanel=getAckordionTabPanel(element),root=tabpanel.parentNode,id=root.getAttribute("id"),accordion=accordions[id],section=qs("section",tabpanel),content=section.firstElementChild;if(tabpanel.classList.toggle(cssClassActive),accordion){if(tabpanel.classList.contains(cssClassActive)?(tabpanel.setAttribute("aria-expanded","true"),expand(content,accordion)):(tabpanel.removeAttribute("aria-expanded"),collapse(content,accordion)),accordion&&accordion.autoClosePrevious&&accordion.previous&&tabpanel!==accordion.previous&&accordion.previous.classList.contains(cssClassActive)){var previousContent=qs("section > div",accordion.previous);collapse(previousContent,accordion),accordion.previous.classList.remove(cssClassActive),accordion.previous.removeAttribute("aria-expanded")}accordion&&(accordions[id].previous=tabpanel)}}}function clearPrevious(id){if(id){var accordion=accordions[id];if(accordion)return accordions[id].previous=void 0,!0}return!1}function destroy(id){if(!id)return!1;var accordion=accordions[id];return accordion?(accordions[id]=void 0,!0):!1}function destroyAll(){Object.keys(accordions).forEach(function(id){accordions[id]=void 0}),accordions={},initCallbacks()}function init(config){config?new Accordion(config):error("ackordion error - you must provide an argument to init")}function initAll(config){qsa(".ackordion").forEach(config&&"object"==typeof config?function(accordion){config.id=accordion.getAttribute("id"),new Accordion(config)}:function(accordion){new Accordion(accordion.getAttribute("id"))})}var callbacks,EVENT_NAMES={init:"init",beforeopen:"beforeopen",afteropen:"afteropen",beforeclose:"beforeclose",afterclose:"afterclose"},document=window.document,console=window.console,log=console.log.bind(console),error=console.error.bind(console),cssClassActive="ackordion--active",accordions={},transitionEndName="transitionend";initCallbacks();var Accordion=function(config){if(!config)return void error("ackordion error - you must provide a config or id");var self=this;if(self.root,self.contents=[],self.previous,self.transition,self.autoClosePrevious=!0,self.closeHeight="0px","string"==typeof config?(self.id=config,self.root=document.getElementById(config)):"object"==typeof config&&(self.id=config.id,self.root=document.getElementById(config.id)),!self.root)return void error("ackordion error - component not found in html with id: "+self.id);if(self.contents=qsa("section > div",self.root),"object"==typeof config){if(self.transition=config.transition||"",self.duration=config.duration||"",self.closeHeight=config.closeHeight||"0px",0!==self.closeHeight.lastIndexOf("0",0)){var css=['.ackordion[id="',self.id,'"] > li:not(.ackordion--active) > section > div { max-height: ',self.closeHeight,";}"].join(""),head=document.head||document.getElementsByTagName("head")[0],style=document.createElement("style");style.styleSheet?style.styleSheet.cssText=css:style.appendChild(document.createTextNode(css)),head.appendChild(style)}config.autoClosePrevious===!1&&(self.autoClosePrevious=!1)}self.transition&&self.contents.forEach(function(content){content.style.transition=self.transition}),self.duration&&self.contents.forEach(function(content){content.style.transitionDuration=config.duration});var id=self.root.getAttribute("id");if(id){accordions[id]&&log("ackordion warning - this id has already been init "+id);var openedTabs=qsa(".ackordion--active",self.root);openedTabs&&openedTabs.length&&(self.previous=openedTabs[0]),accordions[id]=self}triggerEvent("init",self)};return{toggle:toggle,init:init,initAll:initAll,clearPrevious:clearPrevious,isTransitionEndDisabled:!1,addCallbackForEvent:addCallbackForEvent,destroy:destroy,destroyAll:destroyAll}});